{{ $imgOrig := .Page.Resources.GetMatch (.Get "src") }}
{{ $img := $imgOrig }}
{{ $size :=  .Get "size" }}
{{- if not $size -}}
    {{ $size = "1400x1040 webp" }}
{{- end }}

{{ $hasExif := false }}

{{ with $img.Exif }}
    {{ $hasExif = true }}

    {{ $orientation := .Tags.Orientation }}
    {{ $img = $img.Fit $size }}

    {{ if (eq $orientation 6) }}
        {{ $img = $img.Resize (printf "%dx%d r270" $img.Height $img.Width) }}
    {{ else if (eq $orientation 8) }}
        {{ $img = $img.Resize (printf "%dx%d r90" $img.Height $img.Width) }}
    {{ end }}
{{ else }}
    {{ $img = $img.Fit $size }}
{{ end }}


<!-- https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/shortcodes/figure.html -->

<div class="d-flex justify-content-center">
    <figure class="figure {{ with .Get "class" }} {{ . }}{{ end }}">
        <a href="{{ $imgOrig.Permalink }}"><img class="figure-img img-fluid rounded" src="{{ $img.Permalink }}"{{- if or (.Get "alt") (.Get "caption") }} alt="{{ with .Get "alt" }}{{ . }}{{ else }}{{ .Get "caption" | markdownify | plainify }}{{ end }}" {{- end -}} {{- with .Get "loading" }} loading="{{ . }}"{{ else }} loading="lazy"{{ end -}}></a>
        {{- if (.Get "caption") -}}
            <figcaption class="figure-caption text-center">
                {{- if .Get "caption" -}}{{- .Get "caption" | markdownify -}}{{- end }}
            </figcaption>
        {{- end }}
    </figure>
</div>